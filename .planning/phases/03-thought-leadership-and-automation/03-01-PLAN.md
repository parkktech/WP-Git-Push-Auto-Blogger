---
phase: 03-thought-leadership-and-automation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scripts/generate-thought-leadership.js
autonomous: true
requirements:
  - LEAD-01
  - LEAD-02
  - LEAD-03
  - LEAD-04

must_haves:
  truths:
    - "Running `node scripts/generate-thought-leadership.js` with valid env vars produces a WordPress draft post"
    - "The pillar/angle selection for a given ISO week number is deterministic — same week always picks the same combination"
    - "All 25 pillar+angle combinations are reachable within a 25-week cycle"
    - "The generated post uses the same SEO/schema structure as commit-triggered posts (JSON-LD BlogPosting + FAQPage)"
    - "Posts are published as draft status to WordPress"
  artifacts:
    - path: "scripts/generate-thought-leadership.js"
      provides: "Thought leadership pipeline entry point with pillar rotation and Claude generation"
      min_lines: 150
  key_links:
    - from: "scripts/generate-thought-leadership.js"
      to: "scripts/evaluate-commit.js"
      via: "require('./evaluate-commit') for POST_JSON_SCHEMA"
      pattern: "require\\('./evaluate-commit'\\)"
    - from: "scripts/generate-thought-leadership.js"
      to: "scripts/brand-voice.js"
      via: "require('./brand-voice') for BRAND, getUrgencyBlock, getRandomFAQs, getRandomCTA"
      pattern: "require\\('./brand-voice'\\)"
    - from: "scripts/generate-thought-leadership.js"
      to: "scripts/wp-client.js"
      via: "require('./wp-client') for uploadMedia, createWordPressPost"
      pattern: "require\\('./wp-client'\\)"
    - from: "scripts/generate-thought-leadership.js"
      to: "scripts/media-pipeline.js"
      via: "require('./media-pipeline') for searchUnsplash"
      pattern: "require\\('./media-pipeline'\\)"
---

<objective>
Create the thought leadership generator script that rotates through 5 content pillars with 5 angle variations each, selected deterministically by ISO week number. The script calls Claude to generate a full blog post, acquires stock images, and publishes as a WordPress draft using the same Phase 2 modules (brand-voice, wp-client, media-pipeline, evaluate-commit schema).

Purpose: Automated weekly content generation that positions Parkk Technology as a thought leader across 5 strategic pillars without manual intervention.
Output: `scripts/generate-thought-leadership.js` — standalone entry point for the thought leadership pipeline.
</objective>

<execution_context>
@/home/jratz/.claude/get-shit-done/workflows/execute-plan.md
@/home/jratz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-thought-leadership-and-automation/03-RESEARCH.md
@.planning/phases/02-blog-post-generator/02-01-SUMMARY.md
@.planning/phases/02-blog-post-generator/02-04-SUMMARY.md
@scripts/generate-blog-post.js
@scripts/evaluate-commit.js
@scripts/brand-voice.js
@scripts/wp-client.js
@scripts/media-pipeline.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create thought leadership generator with pillar rotation and Claude generation</name>
  <files>scripts/generate-thought-leadership.js</files>
  <action>
Create `scripts/generate-thought-leadership.js` as a CommonJS module with the following structure:

**1. Imports — reuse Phase 2 modules directly:**
```javascript
const { BRAND, getUrgencyBlock, getRandomFAQs, getRandomCTA } = require('./brand-voice');
const { POST_JSON_SCHEMA } = require('./evaluate-commit');
const { searchUnsplash } = require('./media-pipeline');
const { uploadMedia, createWordPressPost } = require('./wp-client');
const { Anthropic } = require('@anthropic-ai/sdk');
```

**2. PILLARS constant** — define exactly the 5 pillars from CONTEXT.md, each with 5 angle variations:
- Pillar 1: "Why Hire an AI Dev Company" — angles: Healthcare patient data/compliance, Finance fraud detection/intelligence, E-commerce personalization/inventory, Cost savings vs in-house build, Speed to market
- Pillar 2: "AI Integration for Existing Businesses" — angles: Back-office automation, Customer-facing AI, Data pipeline modernization, Competitive advantage (integration-first), E-commerce personalization/upsell
- Pillar 3: "Building AI Products from Scratch" — angles: Full product build, Healthcare diagnostics, Finance AI-native platforms, Equity partnership model, AI-augmented dev speed
- Pillar 4: "Industry-Specific AI Solutions" — angles: Healthcare HIPAA compliance, Finance fraud/compliance, E-commerce demand/pricing, Professional services contracts/knowledge, Logistics route/maintenance
- Pillar 5: "Our Approach & Case Studies" — angles: Scoping process, Portfolio showcase, Equity model explained, Why we publish every commit, AI-augmented timelines

Use the exact angle text from 03-RESEARCH.md Pattern 1 (the PILLARS array with full descriptive strings for each angle).

**3. getISOWeekNumber(date) function** — use the zero-dependency ISO 8601 week calculation from research:
```javascript
function getISOWeekNumber(date) {
  const d = new Date(date.getTime());
  d.setHours(0, 0, 0, 0);
  d.setDate(d.getDate() + 3 - (d.getDay() + 6) % 7);
  const week1 = new Date(d.getFullYear(), 0, 4);
  return 1 + Math.round(((d.getTime() - week1.getTime()) / 86400000 - 3 + (week1.getDay() + 6) % 7) / 7);
}
```

**4. selectPillarAndAngle(date) function** — deterministic selection:
- `pillarIndex = weekNumber % 5`
- `angleIndex = Math.floor(weekNumber / 5) % 5`
- Returns `{ pillar, angle, weekNumber, pillarIndex, angleIndex }`

**5. buildThoughtLeadershipPrompt(brand, pillar, angle, urgencyBlock, faqs, cta) function** — system prompt that:
- Identifies Claude as a thought leadership writer for Parkk Technology
- Sets the TOPIC (pillar.name) and ANGLE (angle string)
- Includes all brand voice rules via `brand.voiceRules.map()`
- Instructs 1500-2500 word depth, no code snippets, business outcomes focus
- Requests answer-first block (40-60 words for AI Overview optimization)
- Includes FAQ templates from brand-voice as inspiration
- Includes urgency block text to weave naturally (not as a section)
- Includes CTA block (heading, body, url, action)
- Requests blogPostingSchema and faqPageSchema JSON-LD generation
- Requests output matching POST_JSON_SCHEMA format

**6. generateThoughtLeadership() async function** — the generation call:
- Initialize module-level Anthropic client (same singleton pattern as evaluate-commit.js)
- Gather brand voice assets: urgencyBlock, faqs, cta
- Build system prompt using the function above
- Call Claude with `model: 'claude-sonnet-4-20250514'` (same as evaluate-commit.js), structured output using POST_JSON_SCHEMA
- The user message should describe the task: generate a thought leadership article on the selected pillar/angle, NOT a commit-based post
- Post-process: inject JSON-LD schema into htmlContent if Claude didn't embed inline (same pattern as evaluate-commit.js generateBlogPost)
- Return the post object

**7. main() async function** — pipeline orchestrator (mirror generate-blog-post.js structure):
- Step 1: Select pillar and angle via selectPillarAndAngle()
- Step 2: Log selected pillar, angle, and week number
- Step 3: Acquire stock images via searchUnsplash(pillar.name, 3)
- Step 4: Generate thought leadership post via generateThoughtLeadership()
- Step 5: Append Unsplash attribution to htmlContent if stock images found (same pattern as generate-blog-post.js Step 5)
- Step 6: Upload media to WordPress (same pattern as generate-blog-post.js Step 6)
- Step 7: Create WordPress post via createWordPressPost(post, mediaIds) — draft status handled by wp-client.js
- Step 8: Send Telegram notification (success only, NOT on failure per CONTEXT.md "silent fail" decision). Reuse the same sendTelegramNotification pattern from generate-blog-post.js — copy the function into this file (it uses native fetch, ~30 lines).
- Step 9: Output JSON summary to stdout

**8. Entry point:**
```javascript
main().catch(err => {
  console.error('Thought leadership pipeline failed:', err.message);
  process.exit(1);
});
```

Per CONTEXT.md: silent fail — log the error, exit cleanly, do NOT send Telegram on failures.

**Key constraints:**
- No new npm dependencies — everything already in Phase 2's package.json
- The script does NOT require COMMIT_MESSAGE or COMMIT_DIFF (unlike generate-blog-post.js)
- Stock images use pillar.name as the search query (not a commit topic_summary)
- No screenshots (no SCREENSHOT_URLS context for thought leadership — no app to screenshot)
  </action>
  <verify>
    <automated>cd /var/www/html/parkktec/parkk-blog-engine && node -e "
const m = require('./scripts/generate-thought-leadership');
// Verify exports exist if any are exported, or just verify the file loads without error
console.log('Module loaded successfully');
" 2>&amp;1 | head -5 &amp;&amp; node -e "
// Verify pillar selection determinism
const fs = require('fs');
const src = fs.readFileSync('scripts/generate-thought-leadership.js', 'utf8');
const hasPillars = src.includes('PILLARS') &amp;&amp; src.includes('Why Hire an AI Dev Company');
const hasWeekFn = src.includes('getISOWeekNumber');
const hasSelect = src.includes('selectPillarAndAngle');
const hasBrandImport = src.includes(\"require('./brand-voice')\");
const hasWpImport = src.includes(\"require('./wp-client')\");
const hasSchemaImport = src.includes('POST_JSON_SCHEMA');
const hasSilentFail = src.includes('process.exit(1)');
console.log('PILLARS:', hasPillars);
console.log('getISOWeekNumber:', hasWeekFn);
console.log('selectPillarAndAngle:', hasSelect);
console.log('brand-voice import:', hasBrandImport);
console.log('wp-client import:', hasWpImport);
console.log('POST_JSON_SCHEMA import:', hasSchemaImport);
console.log('Silent fail:', hasSilentFail);
const allPass = hasPillars &amp;&amp; hasWeekFn &amp;&amp; hasSelect &amp;&amp; hasBrandImport &amp;&amp; hasWpImport &amp;&amp; hasSchemaImport &amp;&amp; hasSilentFail;
if (!allPass) { process.exit(1); }
console.log('ALL CHECKS PASSED');
"</automated>
    <manual>Review generate-thought-leadership.js structure mirrors generate-blog-post.js pattern</manual>
  </verify>
  <done>
- scripts/generate-thought-leadership.js exists with 5 pillars x 5 angles = 25 combinations
- Pillar/angle selection is deterministic by ISO week number
- Script reuses POST_JSON_SCHEMA, brand-voice, wp-client, and media-pipeline from Phase 2
- Claude generates full blog post JSON with SEO/schema matching commit post structure
- Silent failure: errors logged and exit(1), no Telegram on failure
- Posts published as draft to WordPress via existing createWordPressPost()
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify pillar rotation determinism and 25-week cycle coverage</name>
  <files>scripts/generate-thought-leadership.js</files>
  <action>
Run a verification script (inline, not saved) that:

1. **Determinism test:** Call selectPillarAndAngle with the same date 10 times — confirm identical output each time.

2. **25-week cycle coverage test:** Iterate weeks 1-25 and confirm all 25 unique (pillarIndex, angleIndex) pairs are produced exactly once. This proves the modular arithmetic covers the full cycle.

3. **Year-boundary test:** Confirm getISOWeekNumber works correctly for:
   - 2026-01-01 (should be ISO week 1)
   - 2025-12-29 (should be ISO week 1 of 2026 — ISO week year boundary)
   - 2026-12-28 (should be ISO week 53 or week 52 depending on year)

4. **Module interface test:** Verify the script requires all expected Phase 2 modules without import errors by doing a shallow require check:
   - `require('./brand-voice')` has BRAND, getUrgencyBlock, getRandomFAQs, getRandomCTA
   - `require('./evaluate-commit')` has POST_JSON_SCHEMA
   - `require('./media-pipeline')` has searchUnsplash
   - `require('./wp-client')` has uploadMedia, createWordPressPost

Run from scripts/ directory to match the require paths.

If any check fails, fix the issue in generate-thought-leadership.js. The pillar selection arithmetic must be correct — this is the core determinism guarantee for LEAD-01 and LEAD-02.
  </action>
  <verify>
    <automated>cd /var/www/html/parkktec/parkk-blog-engine/scripts &amp;&amp; node -e "
const { getISOWeekNumber, selectPillarAndAngle } = require('./generate-thought-leadership');
// Determinism: same date -> same result
const d = new Date('2026-03-02');
const r1 = selectPillarAndAngle(d);
const r2 = selectPillarAndAngle(d);
console.assert(r1.pillarIndex === r2.pillarIndex, 'Determinism failed');
console.assert(r1.angleIndex === r2.angleIndex, 'Determinism failed');
// Coverage: weeks 1-25 cover all 25 combos
const seen = new Set();
for (let w = 1; w <= 25; w++) { seen.add((w % 5) + ',' + (Math.floor(w / 5) % 5)); }
console.assert(seen.size === 25, 'Coverage: expected 25, got ' + seen.size);
console.log('ALL DETERMINISM CHECKS PASSED');
" 2>&amp;1 | tail -1</automated>
  </verify>
  <done>
- selectPillarAndAngle returns identical results for the same date across multiple calls
- Weeks 1-25 produce all 25 unique (pillarIndex, angleIndex) pairs with no duplicates
- getISOWeekNumber handles year boundaries correctly
- All Phase 2 module imports resolve without error
  </done>
</task>

</tasks>

<verification>
1. `scripts/generate-thought-leadership.js` exists and loads without syntax errors
2. The PILLARS array contains exactly 5 pillars, each with exactly 5 angles
3. selectPillarAndAngle is deterministic (same date = same result)
4. 25-week cycle covers all pillar+angle combinations
5. Script reuses Phase 2 modules: brand-voice, evaluate-commit (schema), media-pipeline, wp-client
6. No new npm dependencies required
7. Silent failure pattern: errors logged, exit(1), no Telegram on failure path
</verification>

<success_criteria>
- `node -e "require('./scripts/generate-thought-leadership')"` loads without error
- Pillar rotation arithmetic verified for weeks 1-25
- All Phase 2 module interfaces (brand-voice, evaluate-commit, media-pipeline, wp-client) are correctly imported
- The script follows the same pipeline pattern as generate-blog-post.js
</success_criteria>

<output>
After completion, create `.planning/phases/03-thought-leadership-and-automation/03-01-SUMMARY.md`
</output>
