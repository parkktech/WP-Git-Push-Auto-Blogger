---
phase: 04-wordpress-ai-discovery-plugin
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - wordpress-plugin/parkk-ai-discovery/parkk-ai-discovery.php
  - wordpress-plugin/parkk-ai-discovery/includes/class-seo-meta-bridge.php
  - wordpress-plugin/parkk-ai-discovery/includes/class-robots-manager.php
autonomous: true
requirements: [PLUG-07, PLUG-09]

must_haves:
  truths:
    - "Plugin activates without errors in WordPress and registers all 6 SEO meta fields for REST API write access"
    - "robots.txt includes Allow rules for 13+ AI crawler user agents"
    - "Phase 2 parkk-seo-meta-bridge.php stub functionality is fully absorbed into the new plugin"
  artifacts:
    - path: "wordpress-plugin/parkk-ai-discovery/parkk-ai-discovery.php"
      provides: "Main plugin entry with bootstrap, activation/deactivation hooks, class autoloading"
      contains: "Plugin Name: Parkk AI Discovery"
    - path: "wordpress-plugin/parkk-ai-discovery/includes/class-seo-meta-bridge.php"
      provides: "SEO meta field registration for Yoast and RankMath REST API access"
      contains: "register_post_meta"
    - path: "wordpress-plugin/parkk-ai-discovery/includes/class-robots-manager.php"
      provides: "robots.txt AI crawler Allow rules via robots_txt filter"
      contains: "robots_txt"
  key_links:
    - from: "wordpress-plugin/parkk-ai-discovery/parkk-ai-discovery.php"
      to: "includes/class-seo-meta-bridge.php"
      via: "require_once in bootstrap"
      pattern: "require_once.*class-seo-meta-bridge"
    - from: "wordpress-plugin/parkk-ai-discovery/parkk-ai-discovery.php"
      to: "includes/class-robots-manager.php"
      via: "require_once in bootstrap"
      pattern: "require_once.*class-robots-manager"
---

<objective>
Create the Parkk AI Discovery plugin scaffold with main entry file, SEO meta bridge (absorbing Phase 2 stub), and robots.txt AI crawler manager.

Purpose: Establish the plugin foundation that all other plans build on. The main entry file defines the plugin header, ABSPATH guard, activation/deactivation hooks (including flush_rewrite_rules for later llms.txt endpoints), and require_once loading for all 5 class files. The SEO meta bridge absorbs the Phase 2 standalone stub. The robots manager adds AI crawler Allow rules.

Output: A functional WordPress plugin that activates cleanly, registers SEO meta fields, and enhances robots.txt.
</objective>

<execution_context>
@/home/jratz/.claude/get-shit-done/workflows/execute-plan.md
@/home/jratz/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-wordpress-ai-discovery-plugin/04-RESEARCH.md

<interfaces>
<!-- Phase 2 SEO meta bridge stub to absorb (wordpress-plugin/parkk-seo-meta-bridge.php): -->
```php
<?php
/**
 * Plugin Name: Parkk SEO Meta Bridge
 * Description: Registers Yoast and RankMath SEO meta fields for REST API write access.
 * Version: 0.1.0
 * Author: Parkk Technology
 * License: MIT
 */
add_action('init', function () {
    $seo_fields = [
        '_yoast_wpseo_metadesc', '_yoast_wpseo_focuskw', '_yoast_wpseo_title',
        'rank_math_focus_keyword', 'rank_math_description', 'rank_math_title',
    ];
    foreach ($seo_fields as $field) {
        register_post_meta('post', $field, [
            'show_in_rest' => true, 'single' => true, 'type' => 'string',
            'auth_callback' => function () { return current_user_can('edit_posts'); },
        ]);
    }
});
```

<!-- AI User-Agent canonical list from research (16 agents): -->
GPTBot, ChatGPT-User, OAI-SearchBot, ClaudeBot, Claude-User, Claude-SearchBot, anthropic-ai, PerplexityBot, Perplexity-User, Google-Extended, Gemini-Deep-Research, Google-CloudVertexBot, cohere-ai, Amazonbot, DuckAssistBot, Meta-ExternalAgent
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create plugin main entry file with bootstrap and activation hooks</name>
  <files>wordpress-plugin/parkk-ai-discovery/parkk-ai-discovery.php</files>
  <action>
Create the main plugin entry file `wordpress-plugin/parkk-ai-discovery/parkk-ai-discovery.php` with:

1. **Plugin header comment block:**
   - Plugin Name: Parkk AI Discovery
   - Description: AI bot detection with markdown serving, llms.txt endpoints, sitewide schema injection, robots.txt optimization, and SEO meta field registration for REST API writes.
   - Version: 1.0.0
   - Author: Parkk Technology
   - Author URI: https://parkktech.com
   - License: MIT

2. **ABSPATH guard:** `if ( ! defined( 'ABSPATH' ) ) { exit; }` immediately after opening `<?php` and header.

3. **Plugin constants:**
   - `PARKK_AI_DISCOVERY_VERSION` = '1.0.0'
   - `PARKK_AI_DISCOVERY_PATH` = `plugin_dir_path( __FILE__ )`
   - `PARKK_AI_DISCOVERY_URL` = `plugin_dir_url( __FILE__ )`

4. **Vendor autoload:** Require the `league/html-to-markdown` autoloader:
   ```php
   $autoload = PARKK_AI_DISCOVERY_PATH . 'vendor/autoload.php';
   if ( file_exists( $autoload ) ) {
       require_once $autoload;
   }
   ```

5. **Class file loading:** `require_once` for all 5 class files in `includes/`:
   - `class-seo-meta-bridge.php`
   - `class-robots-manager.php`
   - `class-ai-responder.php`
   - `class-schema-injector.php`
   - `class-llms-endpoints.php`
   Each wrapped in `file_exists()` check so the plugin doesn't fatal when later plans haven't created those files yet.

6. **Initialization function** `parkk_ai_discovery_init()` hooked to `init` action:
   - Instantiates each class if it exists: `if ( class_exists( 'Parkk_SEO_Meta_Bridge' ) ) { new Parkk_SEO_Meta_Bridge(); }`
   - Same pattern for all 5 classes: `Parkk_SEO_Meta_Bridge`, `Parkk_Robots_Manager`, `Parkk_AI_Responder`, `Parkk_Schema_Injector`, `Parkk_LLMS_Endpoints`
   - NOTE: `Parkk_Schema_Injector` and `Parkk_LLMS_Endpoints` hook into `wp_head` and `template_redirect` respectively inside their own constructors, so instantiation on `init` is fine.

7. **Activation hook** via `register_activation_hook( __FILE__, 'parkk_ai_discovery_activate' )`:
   - Calls `flush_rewrite_rules()` (needed for llms.txt endpoints added by later plans)

8. **Deactivation hook** via `register_deactivation_hook( __FILE__, 'parkk_ai_discovery_deactivate' )`:
   - Calls `flush_rewrite_rules()` to clean up custom rewrite rules

Do NOT use a class-based bootstrap — use simple functions. The plugin is small enough that a procedural bootstrap is clearer.
  </action>
  <verify>
    <automated>php -l wordpress-plugin/parkk-ai-discovery/parkk-ai-discovery.php</automated>
  </verify>
  <done>Main plugin file exists with valid PHP syntax, defines constants, loads class files conditionally, and registers activation/deactivation hooks with flush_rewrite_rules</done>
</task>

<task type="auto">
  <name>Task 2: Create SEO meta bridge class and robots.txt manager class</name>
  <files>
wordpress-plugin/parkk-ai-discovery/includes/class-seo-meta-bridge.php
wordpress-plugin/parkk-ai-discovery/includes/class-robots-manager.php
  </files>
  <action>
**File 1: `wordpress-plugin/parkk-ai-discovery/includes/class-seo-meta-bridge.php`**

Create a class `Parkk_SEO_Meta_Bridge` that absorbs the Phase 2 `parkk-seo-meta-bridge.php` stub logic:

1. ABSPATH guard at top of file.
2. Class with constructor that hooks `register_fields` method to `init` action.
3. `register_fields()` method registers all 6 SEO meta fields unconditionally (no `class_exists` checks — per locked decision from Phase 2: "Register all 6 SEO fields unconditionally for pipeline testing flexibility"):
   - `_yoast_wpseo_metadesc`
   - `_yoast_wpseo_focuskw`
   - `_yoast_wpseo_title`
   - `rank_math_focus_keyword`
   - `rank_math_description`
   - `rank_math_title`
4. Each field: `register_post_meta( 'post', $field, [ 'show_in_rest' => true, 'single' => true, 'type' => 'string', 'auth_callback' => function() { return current_user_can( 'edit_posts' ); } ] )`
5. The logic is identical to the Phase 2 stub but wrapped in a class.

**File 2: `wordpress-plugin/parkk-ai-discovery/includes/class-robots-manager.php`**

Create a class `Parkk_Robots_Manager`:

1. ABSPATH guard at top of file.
2. Class with constructor that hooks `modify_robots_txt` to the `robots_txt` filter (priority 10, accepts 2 args: `$output`, `$public`).
3. `get_ai_user_agents()` static method returns the canonical 16-agent array:
   `GPTBot`, `ChatGPT-User`, `OAI-SearchBot`, `ClaudeBot`, `Claude-User`, `Claude-SearchBot`, `anthropic-ai`, `PerplexityBot`, `Perplexity-User`, `Google-Extended`, `Gemini-Deep-Research`, `Google-CloudVertexBot`, `cohere-ai`, `Amazonbot`, `DuckAssistBot`, `Meta-ExternalAgent`
4. `modify_robots_txt( $output, $public )` method:
   - Appends a blank line then a comment: `# Parkk AI Discovery — AI Crawler Rules`
   - For each user agent in the list, appends:
     ```
     User-agent: {agent}
     Allow: /
     ```
   - After all agents, appends:
     ```
     # Content Signals Policy
     User-agent: *
     Content-Signal: ai-train=yes, search=yes, ai-input=yes
     ```
   - Returns the modified `$output`.

This method makes `get_ai_user_agents()` static and public so `class-ai-responder.php` (created in Plan 02) can reuse the same list for UA detection without duplication.
  </action>
  <verify>
    <automated>php -l wordpress-plugin/parkk-ai-discovery/includes/class-seo-meta-bridge.php && php -l wordpress-plugin/parkk-ai-discovery/includes/class-robots-manager.php</automated>
  </verify>
  <done>Both class files have valid PHP syntax. SEO meta bridge registers all 6 fields identically to Phase 2 stub. Robots manager appends Allow rules for 16 AI user agents plus Content-Signal policy to robots.txt output.</done>
</task>

</tasks>

<verification>
1. `php -l` passes on all 3 created PHP files (no syntax errors)
2. Main plugin file defines PARKK_AI_DISCOVERY_VERSION, PARKK_AI_DISCOVERY_PATH constants
3. Main plugin file contains `register_activation_hook` and `register_deactivation_hook` calls
4. SEO meta bridge class registers exactly 6 fields with `show_in_rest => true`
5. Robots manager class `get_ai_user_agents()` returns array with 16 entries (13+ per requirement)
6. Robots manager modifies `robots_txt` filter output to include Allow rules
</verification>

<success_criteria>
- Plugin scaffold is complete with main entry, SEO meta bridge, and robots manager
- All 3 files pass PHP lint
- SEO meta bridge is a class-based version of the Phase 2 stub (identical field list, identical registration args)
- Robots manager adds Allow rules for 16 AI crawlers to WordPress robots.txt
- Main bootstrap conditionally loads all 5 class files (3 exist now, 2 will be created by later plans)
</success_criteria>

<output>
After completion, create `.planning/phases/04-wordpress-ai-discovery-plugin/04-01-SUMMARY.md`
</output>
